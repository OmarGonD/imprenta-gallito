download.file(img_url, ruta_completa, mode = "wb", quiet = TRUE)
Sys.sleep(0.5) # PequeÃ±a pausa
}, silent = TRUE)
imagenes_descargadas <- c(imagenes_descargadas, img_url)
archivo_final <- nombre_archivo
contador_global <- contador_global + 1
}
sku <- paste0(
"VP",
str_to_upper(paste(sample(c(LETTERS, 0:9), 8, replace = TRUE), collapse = ""))
)
}
productos <- rbind(productos, data.frame(
Nombre         = nombre,
Descripcion    = desc,
Precio_Info    = precio,
Categoria_URL  = url_categoria,
Imagen_URL     = ifelse(is.na(img_url), "Sin imagen", img_url),
Archivo_Imagen = archivo_final,
SKU_Aleatorio  = sku,
stringsAsFactors = FALSE
))
}
}
csv_path <- file.path(CARPETA_DESTINO, "vistaprint_todos_los_productos.csv")
write_excel_csv(productos, csv_path)
cat("\nâœ… DESCARGA FINALIZADA\n")
cat("ðŸ–¼ï¸ ImÃ¡genes Ãºnicas:", contador_global - 1, "\n")
cat("ðŸ“ Carpeta:", CARPETA_DESTINO, "\n")
invisible(productos)
}
# ======================= EJECUTAR =======================
if (exists("URLS_A_PROCESAR")) {
resultado <- descargar_vistaprint_pro(URLS_A_PROCESAR)
print(head(resultado))
} else {
cat("Error: No has definido URLS_A_PROCESAR al inicio del script.")
}
# ===============================================================
# VISTAPRINT SCRAPER PRO - CONFIGURACIÃ“N CENTRALIZADA
# ===============================================================
# 1. INSTALACIÃ“N Y CARGA DE PAQUETES
paquetes <- c("httr", "xml2", "stringr", "readr", "rvest", "dplyr")
instalados <- paquetes %in% rownames(installed.packages())
if (any(!instalados)) install.packages(paquetes[!instalados])
library(httr)
library(xml2)
library(stringr)
library(readr)
library(rvest)
library(dplyr)
# ==================== âš™ï¸ CONFIGURACIÃ“N DE USUARIO âš™ï¸ ====================
# ==============================================================================
# 1. CONFIGURACIÃ“N DE LA CARPETA DE DESTINO (MÃ‰TODO SEGURO PARA WINDOWS)
# ==============================================================================
# INSTRUCCIÃ“N: Pega la ruta de Windows tal cual dentro de r"( ... )"
ruta_cruda <- r"(D:\web_proyects\imprenta_gallito\static\media\product_images\productos_promocionales\uso_personal)"
# Limpieza automÃ¡tica de la ruta (cambia \ por /)
CARPETA_DESTINO <- gsub("\\\\", "/", ruta_cruda)
# VerificaciÃ³n en consola
message("La ruta configurada es: ", CARPETA_DESTINO)
# ==============================================================================
# 2. LISTA DE URLS A PROCESAR (Â¡AQUÃ PONES TUS LINKS!)
# ==============================================================================
URLS_A_PROCESAR <- c(
# Pega aquÃ­ las URLs de las categorÃ­as que quieras descargar, separadas por coma
"https://www.vistaprint.com/promotional-products/lifestyle"
# Puedes aÃ±adir mÃ¡s lÃ­neas siguiendo el formato
)
# ==============================================================================
# 3. PREPARACIÃ“N DEL DIRECTORIO
# ==============================================================================
# Si la carpeta no existe, la crea (incluyendo subcarpetas si faltan)
if (!dir.exists(CARPETA_DESTINO)) {
dir.create(CARPETA_DESTINO, recursive = TRUE)
message(">> Carpeta creada exitosamente.")
} else {
message(">> La carpeta ya existe. Se guardarÃ¡n los archivos ahÃ­.")
}
# Establecer el directorio de trabajo
setwd(CARPETA_DESTINO)
# Nombre base para archivos basado en la carpeta final
NOMBRE_BASE_ARCHIVO <- basename(CARPETA_DESTINO) %>%
str_to_lower() %>%
str_replace_all("[^a-z0-9]", "-") %>%
str_replace_all("-{2,}", "-") %>%
str_remove("^-|-$")
# ===============================================================
# DEFINICIÃ“N DE LA FUNCIÃ“N DE SCRAPING
# ===============================================================
descargar_vistaprint_pro <- function(urls) {
productos <- data.frame(
Nombre         = character(),
Descripcion    = character(),
Precio_Info    = character(),
Categoria_URL  = character(),
Imagen_URL     = character(),
Archivo_Imagen = character(),
SKU_Aleatorio  = character(),
stringsAsFactors = FALSE
)
contador_global <- 1
imagenes_descargadas <- character()  # ðŸ”’ evita duplicados reales
for (url_categoria in urls) {
cat("\nProcesando:", url_categoria, "\n")
# ValidaciÃ³n simple de URL vacÃ­a
if (url_categoria == "PON_AQUI_TU_URL_DE_VISTAPRINT") {
cat("âš ï¸ ALERTA: URL de ejemplo detectada. Saltando...\n")
next
}
resp <- GET(url_categoria, user_agent("Mozilla/5.0"))
if (status_code(resp) != 200) {
cat("Error al acceder a la URL:", status_code(resp), "\n")
next
}
html <- read_html(resp)
nodos <- html %>% xml_find_all(
".//div[contains(@class,'product') or
contains(@class,'tile') or
contains(@class,'item') or
contains(@class,'card')]"
)
if (length(nodos) == 0) {
nodos <- html %>% xml_find_all("//img/ancestor::div[.//a]")
}
cat("Productos encontrados:", length(nodos), "\n")
for (nodo in nodos) {
nombre <- nodo %>%
xml_find_first(".//h1|.//h2|.//h3|.//span[contains(@class,'title')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin nombre", .)}
desc <- nodo %>%
xml_find_first(".//p|.//div[contains(@class,'description') or contains(@class,'subtitle')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin descripciÃ³n", .)}
precio <- nodo %>%
xml_find_first(".//*[contains(@class,'price') or contains(text(),'$') or contains(text(),'From')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin precio", .)}
# ðŸ‘‰ SOLO LA PRIMERA IMAGEN REAL DEL NODO
img_node <- nodo %>% xml_find_first(".//img[1]")
img_url <- xml_attr(img_node, "src") %||%
xml_attr(img_node, "data-src") %||%
xml_attr(img_node, "data-lazy-src") %||% NA
archivo_final <- "No descargada"
sku <- "N/A"
if (!is.na(img_url) && img_url != "") {
if (str_starts(img_url, "//")) img_url <- paste0("https:", img_url)
if (str_starts(img_url, "/"))  img_url <- paste0("https://www.vistaprint.com", img_url)
# ðŸš« evitar descargar la misma imagen otra vez
if (!(img_url %in% imagenes_descargadas)) {
nombre_archivo <- paste0(
NOMBRE_BASE_ARCHIVO, "-",
str_pad(contador_global, 4, pad = "0"),
".jpg"
)
ruta_completa <- file.path(CARPETA_DESTINO, nombre_archivo)
try({
download.file(img_url, ruta_completa, mode = "wb", quiet = TRUE)
Sys.sleep(0.5) # PequeÃ±a pausa
}, silent = TRUE)
imagenes_descargadas <- c(imagenes_descargadas, img_url)
archivo_final <- nombre_archivo
contador_global <- contador_global + 1
}
sku <- paste0(
"VP",
str_to_upper(paste(sample(c(LETTERS, 0:9), 8, replace = TRUE), collapse = ""))
)
}
productos <- rbind(productos, data.frame(
Nombre         = nombre,
Descripcion    = desc,
Precio_Info    = precio,
Categoria_URL  = url_categoria,
Imagen_URL     = ifelse(is.na(img_url), "Sin imagen", img_url),
Archivo_Imagen = archivo_final,
SKU_Aleatorio  = sku,
stringsAsFactors = FALSE
))
}
}
csv_path <- file.path(CARPETA_DESTINO, "vistaprint_todos_los_productos.csv")
write_excel_csv(productos, csv_path)
cat("\nâœ… DESCARGA FINALIZADA\n")
cat("ðŸ–¼ï¸ ImÃ¡genes Ãºnicas:", contador_global - 1, "\n")
cat("ðŸ“ Carpeta:", CARPETA_DESTINO, "\n")
invisible(productos)
}
# ======================= EJECUTAR =======================
if (exists("URLS_A_PROCESAR")) {
resultado <- descargar_vistaprint_pro(URLS_A_PROCESAR)
print(head(resultado))
} else {
cat("Error: No has definido URLS_A_PROCESAR al inicio del script.")
}
# ===============================================================
# VISTAPRINT SCRAPER PRO - CONFIGURACIÃ“N CENTRALIZADA
# ===============================================================
# 1. INSTALACIÃ“N Y CARGA DE PAQUETES
paquetes <- c("httr", "xml2", "stringr", "readr", "rvest", "dplyr")
instalados <- paquetes %in% rownames(installed.packages())
if (any(!instalados)) install.packages(paquetes[!instalados])
library(httr)
library(xml2)
library(stringr)
library(readr)
library(rvest)
library(dplyr)
# ==================== âš™ï¸ CONFIGURACIÃ“N DE USUARIO âš™ï¸ ====================
# ==============================================================================
# 1. CONFIGURACIÃ“N DE LA CARPETA DE DESTINO (MÃ‰TODO SEGURO PARA WINDOWS)
# ==============================================================================
# INSTRUCCIÃ“N: Pega la ruta de Windows tal cual dentro de r"( ... )"
ruta_cruda <- r"(D:\web_proyects\imprenta_gallito\static\media\product_images\productos_promocionales\tecnologia)"
# Limpieza automÃ¡tica de la ruta (cambia \ por /)
CARPETA_DESTINO <- gsub("\\\\", "/", ruta_cruda)
# VerificaciÃ³n en consola
message("La ruta configurada es: ", CARPETA_DESTINO)
# ==============================================================================
# 2. LISTA DE URLS A PROCESAR (Â¡AQUÃ PONES TUS LINKS!)
# ==============================================================================
URLS_A_PROCESAR <- c(
# Pega aquÃ­ las URLs de las categorÃ­as que quieras descargar, separadas por coma
"https://www.vistaprint.com/promotional-products/technology/all-technology"
# Puedes aÃ±adir mÃ¡s lÃ­neas siguiendo el formato
)
# ==============================================================================
# 3. PREPARACIÃ“N DEL DIRECTORIO
# ==============================================================================
# Si la carpeta no existe, la crea (incluyendo subcarpetas si faltan)
if (!dir.exists(CARPETA_DESTINO)) {
dir.create(CARPETA_DESTINO, recursive = TRUE)
message(">> Carpeta creada exitosamente.")
} else {
message(">> La carpeta ya existe. Se guardarÃ¡n los archivos ahÃ­.")
}
# Establecer el directorio de trabajo
setwd(CARPETA_DESTINO)
# Nombre base para archivos basado en la carpeta final
NOMBRE_BASE_ARCHIVO <- basename(CARPETA_DESTINO) %>%
str_to_lower() %>%
str_replace_all("[^a-z0-9]", "-") %>%
str_replace_all("-{2,}", "-") %>%
str_remove("^-|-$")
# ===============================================================
# DEFINICIÃ“N DE LA FUNCIÃ“N DE SCRAPING
# ===============================================================
descargar_vistaprint_pro <- function(urls) {
productos <- data.frame(
Nombre         = character(),
Descripcion    = character(),
Precio_Info    = character(),
Categoria_URL  = character(),
Imagen_URL     = character(),
Archivo_Imagen = character(),
SKU_Aleatorio  = character(),
stringsAsFactors = FALSE
)
contador_global <- 1
imagenes_descargadas <- character()  # ðŸ”’ evita duplicados reales
for (url_categoria in urls) {
cat("\nProcesando:", url_categoria, "\n")
# ValidaciÃ³n simple de URL vacÃ­a
if (url_categoria == "PON_AQUI_TU_URL_DE_VISTAPRINT") {
cat("âš ï¸ ALERTA: URL de ejemplo detectada. Saltando...\n")
next
}
resp <- GET(url_categoria, user_agent("Mozilla/5.0"))
if (status_code(resp) != 200) {
cat("Error al acceder a la URL:", status_code(resp), "\n")
next
}
html <- read_html(resp)
nodos <- html %>% xml_find_all(
".//div[contains(@class,'product') or
contains(@class,'tile') or
contains(@class,'item') or
contains(@class,'card')]"
)
if (length(nodos) == 0) {
nodos <- html %>% xml_find_all("//img/ancestor::div[.//a]")
}
cat("Productos encontrados:", length(nodos), "\n")
for (nodo in nodos) {
nombre <- nodo %>%
xml_find_first(".//h1|.//h2|.//h3|.//span[contains(@class,'title')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin nombre", .)}
desc <- nodo %>%
xml_find_first(".//p|.//div[contains(@class,'description') or contains(@class,'subtitle')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin descripciÃ³n", .)}
precio <- nodo %>%
xml_find_first(".//*[contains(@class,'price') or contains(text(),'$') or contains(text(),'From')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin precio", .)}
# ðŸ‘‰ SOLO LA PRIMERA IMAGEN REAL DEL NODO
img_node <- nodo %>% xml_find_first(".//img[1]")
img_url <- xml_attr(img_node, "src") %||%
xml_attr(img_node, "data-src") %||%
xml_attr(img_node, "data-lazy-src") %||% NA
archivo_final <- "No descargada"
sku <- "N/A"
if (!is.na(img_url) && img_url != "") {
if (str_starts(img_url, "//")) img_url <- paste0("https:", img_url)
if (str_starts(img_url, "/"))  img_url <- paste0("https://www.vistaprint.com", img_url)
# ðŸš« evitar descargar la misma imagen otra vez
if (!(img_url %in% imagenes_descargadas)) {
nombre_archivo <- paste0(
NOMBRE_BASE_ARCHIVO, "-",
str_pad(contador_global, 4, pad = "0"),
".jpg"
)
ruta_completa <- file.path(CARPETA_DESTINO, nombre_archivo)
try({
download.file(img_url, ruta_completa, mode = "wb", quiet = TRUE)
Sys.sleep(0.5) # PequeÃ±a pausa
}, silent = TRUE)
imagenes_descargadas <- c(imagenes_descargadas, img_url)
archivo_final <- nombre_archivo
contador_global <- contador_global + 1
}
sku <- paste0(
"VP",
str_to_upper(paste(sample(c(LETTERS, 0:9), 8, replace = TRUE), collapse = ""))
)
}
productos <- rbind(productos, data.frame(
Nombre         = nombre,
Descripcion    = desc,
Precio_Info    = precio,
Categoria_URL  = url_categoria,
Imagen_URL     = ifelse(is.na(img_url), "Sin imagen", img_url),
Archivo_Imagen = archivo_final,
SKU_Aleatorio  = sku,
stringsAsFactors = FALSE
))
}
}
csv_path <- file.path(CARPETA_DESTINO, "vistaprint_todos_los_productos.csv")
write_excel_csv(productos, csv_path)
cat("\nâœ… DESCARGA FINALIZADA\n")
cat("ðŸ–¼ï¸ ImÃ¡genes Ãºnicas:", contador_global - 1, "\n")
cat("ðŸ“ Carpeta:", CARPETA_DESTINO, "\n")
invisible(productos)
}
# ======================= EJECUTAR =======================
if (exists("URLS_A_PROCESAR")) {
resultado <- descargar_vistaprint_pro(URLS_A_PROCESAR)
print(head(resultado))
} else {
cat("Error: No has definido URLS_A_PROCESAR al inicio del script.")
}
# ===============================================================
# VISTAPRINT SCRAPER PRO - CONFIGURACIÃ“N CENTRALIZADA
# ===============================================================
# 1. INSTALACIÃ“N Y CARGA DE PAQUETES
paquetes <- c("httr", "xml2", "stringr", "readr", "rvest", "dplyr")
instalados <- paquetes %in% rownames(installed.packages())
if (any(!instalados)) install.packages(paquetes[!instalados])
library(httr)
library(xml2)
library(stringr)
library(readr)
library(rvest)
library(dplyr)
# ==================== âš™ï¸ CONFIGURACIÃ“N DE USUARIO âš™ï¸ ====================
# ==============================================================================
# 1. CONFIGURACIÃ“N DE LA CARPETA DE DESTINO (MÃ‰TODO SEGURO PARA WINDOWS)
# ==============================================================================
# INSTRUCCIÃ“N: Pega la ruta de Windows tal cual dentro de r"( ... )"
ruta_cruda <- r"(D:\web_proyects\imprenta_gallito\static\media\product_images\productos_promocionales\snacks_caramelos)"
# Limpieza automÃ¡tica de la ruta (cambia \ por /)
CARPETA_DESTINO <- gsub("\\\\", "/", ruta_cruda)
# VerificaciÃ³n en consola
message("La ruta configurada es: ", CARPETA_DESTINO)
# ==============================================================================
# 2. LISTA DE URLS A PROCESAR (Â¡AQUÃ PONES TUS LINKS!)
# ==============================================================================
URLS_A_PROCESAR <- c(
# Pega aquÃ­ las URLs de las categorÃ­as que quieras descargar, separadas por coma
"https://www.vistaprint.com/promotional-products/food"
# Puedes aÃ±adir mÃ¡s lÃ­neas siguiendo el formato
)
# ==============================================================================
# 3. PREPARACIÃ“N DEL DIRECTORIO
# ==============================================================================
# Si la carpeta no existe, la crea (incluyendo subcarpetas si faltan)
if (!dir.exists(CARPETA_DESTINO)) {
dir.create(CARPETA_DESTINO, recursive = TRUE)
message(">> Carpeta creada exitosamente.")
} else {
message(">> La carpeta ya existe. Se guardarÃ¡n los archivos ahÃ­.")
}
# Establecer el directorio de trabajo
setwd(CARPETA_DESTINO)
# Nombre base para archivos basado en la carpeta final
NOMBRE_BASE_ARCHIVO <- basename(CARPETA_DESTINO) %>%
str_to_lower() %>%
str_replace_all("[^a-z0-9]", "-") %>%
str_replace_all("-{2,}", "-") %>%
str_remove("^-|-$")
# ===============================================================
# DEFINICIÃ“N DE LA FUNCIÃ“N DE SCRAPING
# ===============================================================
descargar_vistaprint_pro <- function(urls) {
productos <- data.frame(
Nombre         = character(),
Descripcion    = character(),
Precio_Info    = character(),
Categoria_URL  = character(),
Imagen_URL     = character(),
Archivo_Imagen = character(),
SKU_Aleatorio  = character(),
stringsAsFactors = FALSE
)
contador_global <- 1
imagenes_descargadas <- character()  # ðŸ”’ evita duplicados reales
for (url_categoria in urls) {
cat("\nProcesando:", url_categoria, "\n")
# ValidaciÃ³n simple de URL vacÃ­a
if (url_categoria == "PON_AQUI_TU_URL_DE_VISTAPRINT") {
cat("âš ï¸ ALERTA: URL de ejemplo detectada. Saltando...\n")
next
}
resp <- GET(url_categoria, user_agent("Mozilla/5.0"))
if (status_code(resp) != 200) {
cat("Error al acceder a la URL:", status_code(resp), "\n")
next
}
html <- read_html(resp)
nodos <- html %>% xml_find_all(
".//div[contains(@class,'product') or
contains(@class,'tile') or
contains(@class,'item') or
contains(@class,'card')]"
)
if (length(nodos) == 0) {
nodos <- html %>% xml_find_all("//img/ancestor::div[.//a]")
}
cat("Productos encontrados:", length(nodos), "\n")
for (nodo in nodos) {
nombre <- nodo %>%
xml_find_first(".//h1|.//h2|.//h3|.//span[contains(@class,'title')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin nombre", .)}
desc <- nodo %>%
xml_find_first(".//p|.//div[contains(@class,'description') or contains(@class,'subtitle')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin descripciÃ³n", .)}
precio <- nodo %>%
xml_find_first(".//*[contains(@class,'price') or contains(text(),'$') or contains(text(),'From')]") %>%
xml_text(trim = TRUE) %>%
{ifelse(is.na(.) || . == "", "Sin precio", .)}
# ðŸ‘‰ SOLO LA PRIMERA IMAGEN REAL DEL NODO
img_node <- nodo %>% xml_find_first(".//img[1]")
img_url <- xml_attr(img_node, "src") %||%
xml_attr(img_node, "data-src") %||%
xml_attr(img_node, "data-lazy-src") %||% NA
archivo_final <- "No descargada"
sku <- "N/A"
if (!is.na(img_url) && img_url != "") {
if (str_starts(img_url, "//")) img_url <- paste0("https:", img_url)
if (str_starts(img_url, "/"))  img_url <- paste0("https://www.vistaprint.com", img_url)
# ðŸš« evitar descargar la misma imagen otra vez
if (!(img_url %in% imagenes_descargadas)) {
nombre_archivo <- paste0(
NOMBRE_BASE_ARCHIVO, "-",
str_pad(contador_global, 4, pad = "0"),
".jpg"
)
ruta_completa <- file.path(CARPETA_DESTINO, nombre_archivo)
try({
download.file(img_url, ruta_completa, mode = "wb", quiet = TRUE)
Sys.sleep(0.5) # PequeÃ±a pausa
}, silent = TRUE)
imagenes_descargadas <- c(imagenes_descargadas, img_url)
archivo_final <- nombre_archivo
contador_global <- contador_global + 1
}
sku <- paste0(
"VP",
str_to_upper(paste(sample(c(LETTERS, 0:9), 8, replace = TRUE), collapse = ""))
)
}
productos <- rbind(productos, data.frame(
Nombre         = nombre,
Descripcion    = desc,
Precio_Info    = precio,
Categoria_URL  = url_categoria,
Imagen_URL     = ifelse(is.na(img_url), "Sin imagen", img_url),
Archivo_Imagen = archivo_final,
SKU_Aleatorio  = sku,
stringsAsFactors = FALSE
))
}
}
csv_path <- file.path(CARPETA_DESTINO, "vistaprint_todos_los_productos.csv")
write_excel_csv(productos, csv_path)
cat("\nâœ… DESCARGA FINALIZADA\n")
cat("ðŸ–¼ï¸ ImÃ¡genes Ãºnicas:", contador_global - 1, "\n")
cat("ðŸ“ Carpeta:", CARPETA_DESTINO, "\n")
invisible(productos)
}
# ======================= EJECUTAR =======================
if (exists("URLS_A_PROCESAR")) {
resultado <- descargar_vistaprint_pro(URLS_A_PROCESAR)
print(head(resultado))
} else {
cat("Error: No has definido URLS_A_PROCESAR al inicio del script.")
}
