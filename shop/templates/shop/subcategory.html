{% extends 'base.html' %}
{% load static %}

{% block title %}{{ subcategory.name }} - {{ category.name }} - Imprenta Gallito{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen">
    
    <!-- Hero Section - Color dinámico según category_type -->
    <section class="py-12 relative overflow-hidden
        {% if category.category_type == 'quality_tiers' %}bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900
        {% elif category.category_type == 'product_types' %}bg-gradient-to-br from-blue-900 via-slate-800 to-slate-900
        {% elif category.category_type == 'formats' %}bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800
        {% elif category.category_type == 'services' %}bg-gradient-to-br from-purple-600 via-purple-700 to-purple-800
        {% elif category.category_type == 'occasions' %}bg-gradient-to-br from-pink-500 via-pink-600 to-pink-700
        {% else %}bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800{% endif %}">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 relative z-10">
            <a href="{% url 'shop:category' category.slug %}" 
               class="inline-flex items-center gap-2 text-white/80 hover:text-white text-sm mb-5 transition-colors">
                <i class="fas fa-arrow-left"></i>
                Volver a {{ category.name }}
            </a>
            
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">{{ subcategory.name }}</h1>
            {% if subcategory.description %}
            <p class="text-lg text-white/90 max-w-xl">{{ subcategory.description }}</p>
            {% endif %}
            
            {% if subcategory.display_style %}
            <div class="inline-flex items-center gap-2 mt-5 px-4 py-2 bg-white/20 rounded-full text-white text-sm">
                {% if subcategory.display_style == 'tab' %}
                <i class="fas fa-layer-group"></i> Nivel de calidad
                {% elif subcategory.display_style == 'circle' %}
                <i class="fas fa-tshirt"></i> Tipo de producto
                {% elif subcategory.display_style == 'card' %}
                <i class="fas fa-th-large"></i> Formato
                {% else %}
                <i class="fas fa-tag"></i> Categoría
                {% endif %}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav">
        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <ol class="breadcrumb">
                <li><a href="{% url 'shop:home' %}">Inicio</a></li>
                <li><a href="{% url 'shop:category' category.slug %}">{{ category.name }}</a></li>
                <li class="active">{{ subcategory.name }}</li>
            </ol>
        </div>
    </nav>

    <!-- Sibling Subcategories -->
    {% if sibling_subcategories %}
    <section class="bg-white py-6 border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <p class="text-sm text-gray-500 mb-4">También en {{ category.name }}:</p>
            
            {% if subcategory.display_style == 'tab' %}
            <!-- TABS Style -->
            <div class="flex flex-wrap gap-3">
                {% for sib in sibling_subcategories %}
                <a href="{% url 'shop:subcategory' category.slug sib.slug %}" 
                   class="px-5 py-2.5 rounded-lg font-medium transition-all border-2
                          {% if sib.slug == subcategory.slug %}
                          bg-blue-600 text-white border-blue-600
                          {% else %}
                          bg-gray-100 text-gray-700 border-transparent hover:border-blue-600 hover:bg-blue-50
                          {% endif %}">
                    {{ sib.name }}
                </a>
                {% endfor %}
            </div>
            
            {% elif subcategory.display_style == 'circle' %}
            <!-- CIRCLES Style -->
            <div class="flex flex-wrap gap-8">
                {% for sib in sibling_subcategories %}
                <a href="{% url 'shop:subcategory' category.slug sib.slug %}" 
                   class="flex flex-col items-center w-24 transition-transform hover:-translate-y-1
                          {% if sib.slug == subcategory.slug %}opacity-100{% else %}opacity-80 hover:opacity-100{% endif %}">
                    <div class="w-16 h-16 rounded-full overflow-hidden border-4 mb-2 transition-colors
                                {% if sib.slug == subcategory.slug %}border-red-500{% else %}border-gray-200 hover:border-blue-500{% endif %}">
                        {% if sib.image_url %}
                        <img src="{% static sib.image_url %}" alt="{{ sib.name }}" class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
                            <i class="fas fa-tag text-white text-lg"></i>
                        </div>
                        {% endif %}
                    </div>
                    <span class="text-xs font-medium text-center
                                 {% if sib.slug == subcategory.slug %}text-red-500{% else %}text-gray-700{% endif %}">
                        {{ sib.name }}
                    </span>
                </a>
                {% endfor %}
            </div>
            
            {% else %}
            <!-- CARDS Style (default) -->
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
                {% for sib in sibling_subcategories %}
                <a href="{% url 'shop:subcategory' category.slug sib.slug %}" 
                   class="flex items-center gap-3 p-3 rounded-xl transition-all border-2
                          {% if sib.slug == subcategory.slug %}
                          border-blue-500 bg-blue-50
                          {% else %}
                          border-transparent bg-gray-50 hover:border-blue-500 hover:bg-white
                          {% endif %}">
                    {% if sib.image_url %}
                    <div class="w-10 h-10 rounded-lg overflow-hidden flex-shrink-0">
                        <img src="{% static sib.image_url %}" alt="{{ sib.name }}" class="w-full h-full object-cover">
                    </div>
                    {% endif %}
                    <span class="text-sm font-medium text-gray-700">{{ sib.name }}</span>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    <!-- Products Section -->
    <section class="py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-gray-900">Productos</h2>
                <span class="text-gray-500">{{ products|length }} producto{{ products|length|pluralize }}</span>
            </div>

            {% if products %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {% for product in products %}
                <a href="{{ product.get_absolute_url }}" class="material-card">
                    <div class="material-image">
                        {% if product.base_image_url %}
                        <img src="{% static product.base_image_url %}" alt="{{ product.name }}">
                        {% else %}
                        <div class="w-full h-full flex flex-col items-center justify-center text-gray-400">
                            <i class="fas fa-image text-4xl mb-2"></i>
                            <span class="text-sm">Sin imagen</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="material-content">
                        <h3>{{ product.name }}</h3>
                        
                        {% if product.description %}
                        <p>{{ product.description|truncatewords:12 }}</p>
                        {% endif %}
                        
                        {% with price_range=product.get_price_range %}
                        <div class="material-price">
                            {% if price_range.0 == price_range.1 %}
                            <span class="price-value">S/ {{ price_range.0 }}</span>
                            {% else %}
                            <span class="price-from">Desde</span>
                            <span class="price-value">S/ {{ price_range.0 }}</span>
                            {% endif %}
                        </div>
                        {% endwith %}
                        
                        <p class="text-xs text-gray-400 mb-3">SKU: {{ product.sku }}</p>
                        
                        <span class="material-cta">Ver Detalles</span>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-20 bg-white rounded-2xl">
                <i class="fas fa-box-open text-6xl text-gray-300 mb-6"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">No hay productos disponibles</h3>
                <p class="text-gray-500 mb-6">Esta subcategoría aún no tiene productos.</p>
                <a href="{% url 'shop:category' category.slug %}" 
                   class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    <i class="fas fa-arrow-left"></i>
                    Volver a {{ category.name }}
                </a>
            </div>
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}
